# Тестовое задание: Backend (Node.js + TypeScript)

Проект находится в стадии активного развития и содержит технический долг.  
Нам важно понять, как вы работаете с существующим кодом, находите риски и принимаете инженерные решения.

## Ограничение по времени

`3–4 часа`

Важно: не требуется полное переписывание архитектуры, внедрение DDD или сложных паттернов.

## Стек

- Node.js
- TypeScript
- Express
- PostgreSQL
- Sequelize
- BullMQ
- Redis
- Docker Compose

## Контекст

В проекте уже есть существующая реализация списания бонусов (legacy-подход).  
Она намеренно наивная и может содержать архитектурные/логические проблемы.

Текущая реализация:

- не использует транзакцию
- не учитывает конкурентность
- не учитывает идемпотентность

Эта реализация используется в endpoint `POST /users/:id/spend`.

## Что нужно сделать

1. Проанализировать текущую реализацию списания бонусов.
2. Предложить и внести улучшения без полного переписывания проекта.
3. Сохранить рабочий запуск проекта через Docker Compose.
4. Сфокусироваться на корректности и инженерных компромиссах.

## Обязательная часть: Анализ и рефакторинг

В `README.md` добавьте раздел `Анализ и рефакторинг` и обязательно ответьте на вопросы:

1. Какие проблемы есть в текущей реализации списания?
2. Какие race conditions возможны?
3. Какие сценарии могут привести к неконсистентным данным?
4. Что бы вы сделали как быстрый фикс?
5. Что бы вы сделали как правильное долгосрочное решение?
6. Какие места в проекте выглядят потенциально проблемными с точки зрения масштабирования?

Ответы обязательны. Без них задание считается неполным.

## Критерии оценки

- умение выявлять архитектурные проблемы
- понимание конкурентности
- аргументированность решений
- умение предлагать компромиссы
- способность работать с уже существующим кодом

## Ограничения

Не требуется:

- полностью переписывать архитектуру
- внедрять DDD
- добавлять сложные паттерны ради паттернов

Оценивается мышление, качество анализа и аккуратность изменений.
